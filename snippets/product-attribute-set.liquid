{% comment %}
  Renders a list of product atributes

    Accepts:
    - products: {Array} Array of products to compare
    - layout: {String} Layout to use ('table', 'flex') - flex will be implemented later

    Usage:
    {% render 'product-attribute-set', products: products, layout: 'table' %}
{% endcomment %}

{% liquid
  assign attribute_names = ''
  assign attribute_keys = ''

  for product in products
      for collection in product.collections
        if collection.metafields.product_attributes.product_attribute_set.value != nil
          for attribute in collection.metafields.product_attributes.product_attribute_set.value.list.value
            if attribute_keys contains attribute.metafield_key
              continue
            endif
            assign attribute_names = attribute_names | append: attribute.display_name | append: '|'
            assign attribute_keys = attribute_keys | append: attribute.metafield_key | append: '|'
          endfor
        endif
      endfor
  endfor

  assign attribute_names = attribute_names | split: '|'
  assign attribute_keys = attribute_keys | split: '|'
%}
{% if layout == 'table' %}
  {% assign keys_length = attribute_keys.size | minus: 1 %}
  {% for i in (0..keys_length) %}
    <tr>
      <th>{{ attribute_names[i] | capitalize }}:</th>
      {% for product in products %}
        <td>
          {{ product.selected_or_first_available_variant.metafields.product_attributes[attribute_keys[i]].value }}
        </td>
      {% endfor %}
    </tr>
  {% endfor %}
{% endif %}