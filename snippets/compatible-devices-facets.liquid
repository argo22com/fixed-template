{% comment %}
  This snippet expects a 'results' prop to be passed in. The 'results' prop should contain the following structure:
  {
    filters: [
      {
        param_name: 'filter.p.m.product_compatible_devices.manufacturers_and_models_map',
        label: 'Model',
        values: [
          { value: 'manufacturer2_model1', label: 'Manufacturer 2 Model 1', active: false },
          { value: 'manufacturer2_model2', label: 'Manufacturer 2 Model 2', active: true }
        ]
      }
    ]
  }
{% endcomment %}

{%- assign manufacturer_filter = results.filters
  | where: 'param_name', 'filter.v.m.product_compatible_devices.manufacturer_code'
  | first
-%}

{%- assign manufacturers_and_models_map_filter = results.filters
  | where: 'param_name', 'filter.p.m.product_compatible_devices.manufacturers_and_models_map'
  | first
-%}

<style>
  @media screen and (min-width: 750px) {
    .compatible-devices-facet-filter {
      width: 20rem;
    }
  }

  @media screen and (max-width: 749px) {
    .compatible-devices-facets > * {
      flex: 1;
    }
  }

  .compatible-devices-facet-filter .select__select {
    padding: 1.2rem 3.2rem 1.2rem 1.2rem;
  }
</style>

<div class="compatible-devices-facets facets facets-active-toolbar flex pt-2">

  <facet-filters-form>
    <form id="FacetFiltersForm">
      {%- comment -%}
        1) Výrobce zařízení – variant metafield product_compatible_devices.manufacturer_code
      {%- endcomment -%}
      {% if manufacturer_filter %}
        <div class="compatible-devices-facet-filter select facets__filter">
          <select
            id="Filter-{{ manufacturer_filter.param_name | escape | handleize }}"
            name="{{ manufacturer_filter.param_name }}"
            class="facets__select select__select"
          >
            <option
              value=""
              {% if manufacturer_filter.active_values == blank or manufacturer_filter.active_values[0].value == blank %}
                selected
              {% endif %}
            >
              {{ 'products.facets.compatible_manufacturers' | t }}
            </option>

            {%- for filter_value in manufacturer_filter.values -%}
              <option
                value="{{ filter_value.value | escape }}"
                {% if filter_value.active %}selected{% endif %}
                {% if filter_value.count == 0 %}disabled{% endif %}
              >
                {{ filter_value.label }}
              </option>
            {%- endfor -%}
          </select>

          {% render 'icon-caret' %}
        </div>
      {% endif %}

      {%- comment -%}
        2) Model zařízení – původní metafield manufacturers_and_models_map
      {%- endcomment -%}
      {% if manufacturers_and_models_map_filter %}
        <div class="compatible-devices-facet-filter select facets__filter">
          <select
            id="Filter-{{ manufacturers_and_models_map_filter.param_name | escape | handleize }}"
            name="{{ manufacturers_and_models_map_filter.param_name }}"
            class="facets__select select__select"
          >
            <option
              value=""
              {% if manufacturers_and_models_map_filter.active_values == blank
                 or manufacturers_and_models_map_filter.active_values[0].value == blank %}
                selected
              {% endif %}
            >
              {{ 'products.facets.compatible_devices' | t }}
            </option>

            {%- for filter_value in manufacturers_and_models_map_filter.values -%}
              <option
                value="{{ filter_value.value | escape }}"
                {% if filter_value.active %}selected{% endif %}
                {% if filter_value.count == 0 %}disabled{% endif %}
              >
                {{ filter_value.label }}
              </option>
            {%- endfor -%}
          </select>

          {% render 'icon-caret' %}
        </div>
      {% endif %}
    </form>
  </facet-filters-form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const scrollPosition = sessionStorage.getItem('facetsScrollPosition');
    if (scrollPosition) {
      window.scrollTo(0, scrollPosition);
      sessionStorage.removeItem('facetsScrollPosition');
    }

    // Uložení pozice před změnou filtru (funguje i s facet-filters-form)
    document.addEventListener('change', function(event) {
      if (event.target.closest('#FacetFiltersForm')) {
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
        sessionStorage.setItem('facetsScrollPosition', scrollPosition);
      }
    });
  });
</script>