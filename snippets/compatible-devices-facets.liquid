{% comment %}
  Očekává se, že snippet dostane `results` (Search & Discovery).
  Filtry:
  - výrobce:   filter.v.m.product_compatible_devices.manufacturer_code
  - zařízení:  filter.v.m.product_compatible_devices.devices_metaobject
{% endcomment %}

{%- assign manufacturer_filter = results.filters
  | where: 'param_name', 'filter.v.m.product_compatible_devices.manufacturer_code'
  | first
-%}

{%- assign devices_filter = results.filters
  | where: 'param_name', 'filter.v.m.product_compatible_devices.devices_metaobject'
  | first
-%}

<style>
  @media screen and (min-width: 750px) {
    .compatible-devices-facet-filter {
      width: 20rem;
    }
  }

  @media screen and (max-width: 749px) {
    .compatible-devices-facets > * {
      flex: 1;
    }
  }

  .compatible-devices-facet-filter .select__select {
    padding: 1.2rem 3.2rem 1.2rem 1.2rem;
  }
</style>

<div class="compatible-devices-facets facets facets-active-toolbar flex pt-2">

  {%- comment -%} VÝROBCE ZAŘÍZENÍ {%- endcomment -%}
  {%- if manufacturer_filter and manufacturer_filter.values.size > 0 -%}
    <div class="compatible-devices-facet-filter select facets__filter">
      <select
        class="facets__select select__select"
        onchange="
          const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
          sessionStorage.setItem('facetsScrollPosition', scrollPosition);
          if (this.value) { window.location.href = this.value; }
        "
      >
        <option value="{{ manufacturer_filter.url_to_remove | escape }}">
          {{ 'products.facets.compatible_manufacturers' | t }}
        </option>

        {%- for filter_value in manufacturer_filter.values -%}

          {%- assign manufacturer_label = filter_value.label -%}

          {%- for m in shop.metaobjects['compatible_devices_manufactures'].values -%}
            {%- if m.code == filter_value.label -%}
              {%- assign manufacturer_label = m.display_name | default: filter_value.label -%}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}

          <option
            value="{{ filter_value.url_to_add | escape }}"
            {%- if filter_value.active -%} selected{%- endif -%}
          >
            {{ manufacturer_label }}
          </option>
        {%- endfor -%}
      </select>

      {% render 'icon-caret' %}
    </div>
  {%- endif -%}

  {%- comment -%} ZAŘÍZENÍ / MODEL {%- endcomment -%}
  {%- if devices_filter and devices_filter.values.size > 0 -%}
    <div class="compatible-devices-facet-filter select facets__filter">
      <select
        class="facets__select select__select"
        onchange="
          const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
          sessionStorage.setItem('facetsScrollPosition', scrollPosition);
          if (this.value) { window.location.href = this.value; }
        "
      >
        <option value="{{ devices_filter.url_to_remove | escape }}">
          {{ 'products.facets.compatible_devices' | t }}
        </option>

        {%- for filter_value in devices_filter.values -%}
          <option
            value="{{ filter_value.url_to_add | escape }}"
            {%- if filter_value.active -%} selected{%- endif -%}
          >
            {{ filter_value.label }}
          </option>
        {%- endfor -%}
      </select>

      {% render 'icon-caret' %}
    </div>
  {%- endif -%}

</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const scrollPosition = sessionStorage.getItem('facetsScrollPosition');
    if (scrollPosition) {
      window.scrollTo(0, scrollPosition);
      sessionStorage.removeItem('facetsScrollPosition');
    }
  });
</script>